import{P as i}from"./index-B2c558M3.js";class a{constructor(t={}){this.id=t.id||null,this.poNumber=t.poNumber||"",this.customerPONumber=t.customerPONumber||"",this.companyId=t.companyId||null,this.companyName=t.companyName||"",this.contactId=t.contactId||null,this.contactName=t.contactName||"",this.contactEmail=t.contactEmail||"",this.status=t.status||"draft",this.approvalStatus=t.approvalStatus||"pending",this.quoteId=t.quoteId||null,this.contractId=t.contractId||null,this.orderId=t.orderId||null,this.items=t.items||[],this.subtotal=t.subtotal||0,this.discountAmount=t.discountAmount||0,this.taxAmount=t.taxAmount||0,this.shippingAmount=t.shippingAmount||0,this.total=t.total||0,this.currency=t.currency||"USD",this.paymentTerms=t.paymentTerms||"Net 30",this.paymentMethod=t.paymentMethod||"invoice",this.paymentStatus=t.paymentStatus||"unpaid",this.paidAmount=t.paidAmount||0,this.shippingAddress=t.shippingAddress||null,this.billingAddress=t.billingAddress||null,this.shippingMethod=t.shippingMethod||"",this.requestedDeliveryDate=t.requestedDeliveryDate||null,this.estimatedDeliveryDate=t.estimatedDeliveryDate||null,this.actualDeliveryDate=t.actualDeliveryDate||null,this.trackingNumber=t.trackingNumber||"",this.carrier=t.carrier||"",this.requiresApproval=t.requiresApproval||!1,this.approvalLimit=t.approvalLimit||0,this.approvers=t.approvers||[],this.approvedBy=t.approvedBy||null,this.approvedAt=t.approvedAt||null,this.rejectedBy=t.rejectedBy||null,this.rejectedAt=t.rejectedAt||null,this.rejectionReason=t.rejectionReason||"",this.specialInstructions=t.specialInstructions||"",this.internalNotes=t.internalNotes||"",this.deliveryInstructions=t.deliveryInstructions||"",this.taxExempt=t.taxExempt||!1,this.taxExemptId=t.taxExemptId||"",this.costCenter=t.costCenter||"",this.budgetCode=t.budgetCode||"",this.projectCode=t.projectCode||"",this.attachments=t.attachments||[],this.accountManagerId=t.accountManagerId||null,this.salesRepId=t.salesRepId||null,this.tags=t.tags||[],this.customFields=t.customFields||{},this.createdAt=t.createdAt||null,this.updatedAt=t.updatedAt||null,this.createdBy=t.createdBy||null,this.submittedAt=t.submittedAt||null}get isApproved(){return this.approvalStatus==="approved"}get isPending(){return this.status==="submitted"&&this.approvalStatus==="pending"}get isFullyPaid(){return this.paymentStatus==="paid"}get remainingBalance(){return this.total-this.paidAmount}get itemCount(){return this.items.reduce((t,e)=>t+e.quantity,0)}calculateTotals(){this.subtotal=this.items.reduce((e,s)=>e+s.quantity*s.unitPrice,0);const t=this.subtotal-this.discountAmount;this.taxExempt?this.taxAmount=0:this.taxAmount=t*.08,this.total=t+this.taxAmount+this.shippingAmount}needsApproval(){return this.requiresApproval?this.approvalLimit===0?!0:this.total>this.approvalLimit:!1}canApprove(t){return!this.needsApproval()||this.approvalStatus!=="pending"?!1:this.approvers.some(e=>e.userId===t&&e.status==="pending")}approve(t,e){const s=this.approvers.find(o=>o.userId===t);s&&(s.status="approved",s.approvedAt=new Date().toISOString()),this.approvers.every(o=>o.status==="approved")&&(this.approvalStatus="approved",this.approvedBy=t,this.approvedAt=new Date().toISOString())}reject(t,e){this.approvalStatus="rejected",this.rejectedBy=t,this.rejectedAt=new Date().toISOString(),this.rejectionReason=e}validate(){const t=[];return this.companyId||t.push("Company is required"),(!this.customerPONumber||this.customerPONumber.trim()==="")&&t.push("Customer PO number is required"),this.items.length===0&&t.push("At least one item is required"),this.shippingAddress||t.push("Shipping address is required"),this.total<=0&&t.push("Total must be greater than zero"),{isValid:t.length===0,errors:t}}toJSON(){return{...this}}static fromAPI(t){return new a(t)}}let n=[{id:1,poNumber:"PO-2024-001",customerPONumber:"ACM-PO-5678",companyId:1,companyName:"Acme Corporation",contactId:1,contactName:"John Smith",contactEmail:"john.smith@acme.com",status:"delivered",approvalStatus:"approved",quoteId:1,contractId:1,orderId:101,items:[{productId:1,sku:"PROD-001",name:"Office Chair - Executive",quantity:50,unitPrice:299.99,discount:10,tax:0,total:13499.55}],subtotal:14999.5,discountAmount:1499.95,taxAmount:1080,shippingAmount:500,total:15079.55,currency:"USD",paymentTerms:"Net 30",paymentMethod:"invoice",paymentStatus:"paid",paidAmount:15079.55,shippingAddress:{street1:"456 Warehouse Rd",city:"Newark",state:"NJ",postalCode:"07101",country:"USA"},billingAddress:{street1:"123 Business Ave",street2:"Suite 100",city:"New York",state:"NY",postalCode:"10001",country:"USA"},shippingMethod:"Ground",requestedDeliveryDate:"2024-11-15",estimatedDeliveryDate:"2024-11-15",actualDeliveryDate:"2024-11-14",trackingNumber:"1Z999AA10123456784",carrier:"UPS",requiresApproval:!0,approvalLimit:1e4,approvers:[{userId:1,name:"Sarah Johnson",status:"approved",approvedAt:"2024-11-01T10:00:00Z"}],approvedBy:1,approvedAt:"2024-11-01T10:00:00Z",specialInstructions:"Deliver to loading dock",internalNotes:"Priority order",taxExempt:!1,costCenter:"CC-001",budgetCode:"BUDGET-2024-Q4",projectCode:"PROJ-456",accountManagerId:1,salesRepId:1,createdAt:"2024-11-01T09:00:00Z",updatedAt:"2024-11-14T15:00:00Z",submittedAt:"2024-11-01T09:30:00Z"},{id:2,poNumber:"PO-2024-002",customerPONumber:"TSI-PO-9012",companyId:2,companyName:"TechStart Inc",contactId:2,contactName:"Jane Doe",contactEmail:"jane.doe@techstart.com",status:"processing",approvalStatus:"approved",quoteId:2,contractId:2,orderId:102,items:[{productId:3,sku:"SERV-001",name:"Rack Server - 2U",quantity:10,unitPrice:4999.99,discount:0,tax:0,total:49999.9}],subtotal:49999.9,discountAmount:0,taxAmount:0,shippingAmount:1e3,total:50999.9,currency:"USD",paymentTerms:"Net 60",paymentMethod:"purchase_order",paymentStatus:"unpaid",paidAmount:0,shippingAddress:{street1:"789 Tech Park",city:"San Francisco",state:"CA",postalCode:"94105",country:"USA"},billingAddress:{street1:"789 Tech Park",city:"San Francisco",state:"CA",postalCode:"94105",country:"USA"},shippingMethod:"Freight",requestedDeliveryDate:"2024-11-25",estimatedDeliveryDate:"2024-11-25",actualDeliveryDate:null,trackingNumber:"",carrier:"",requiresApproval:!1,approvalLimit:0,approvers:[],approvedBy:null,approvedAt:null,specialInstructions:"Call before delivery",internalNotes:"",taxExempt:!0,taxExemptId:"TX-12345",costCenter:"CC-TECH-001",budgetCode:"TECH-2024-CAP",projectCode:"DC-UPGRADE",accountManagerId:1,salesRepId:1,createdAt:"2024-11-10T14:00:00Z",updatedAt:"2024-11-10T14:30:00Z",submittedAt:"2024-11-10T14:30:00Z"}],p=3;async function c(r={}){await i(200);let t=[...n];if(r.status&&(t=t.filter(e=>e.status===r.status)),r.approvalStatus&&(t=t.filter(e=>e.approvalStatus===r.approvalStatus)),r.companyId&&(t=t.filter(e=>e.companyId===parseInt(r.companyId))),r.paymentStatus&&(t=t.filter(e=>e.paymentStatus===r.paymentStatus)),r.search){const e=r.search.toLowerCase();t=t.filter(s=>s.poNumber.toLowerCase().includes(e)||s.customerPONumber.toLowerCase().includes(e)||s.companyName.toLowerCase().includes(e))}return t.sort((e,s)=>new Date(s.createdAt)-new Date(e.createdAt)),t.map(e=>a.fromAPI(e))}async function d(r){await i(200);const t=n.find(e=>e.id===parseInt(r));return t?a.fromAPI(t):null}async function l(r){await i(200);const t=n.find(e=>e.poNumber===r);return t?a.fromAPI(t):null}async function h(r){return await i(200),n.filter(e=>e.companyId===parseInt(r)).map(e=>a.fromAPI(e))}async function m(r){await i(300);const t=new a(r);if(!t.poNumber){const o=new Date().getFullYear();t.poNumber=`PO-${o}-${String(p).padStart(3,"0")}`}t.calculateTotals();const e=t.validate();if(!e.isValid)throw new Error(`Validation failed: ${e.errors.join(", ")}`);const s={...t.toJSON(),id:p++,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return n.push(s),a.fromAPI(s)}async function f(r,t){await i(300);const e=n.findIndex(s=>s.id===parseInt(r));if(e===-1)throw new Error("Purchase order not found");if(n[e]={...n[e],...t,updatedAt:new Date().toISOString()},t.items){const s=a.fromAPI(n[e]);s.calculateTotals(),n[e]=s.toJSON()}return a.fromAPI(n[e])}async function A(r){await i(300);const t=n.findIndex(e=>e.id===parseInt(r));if(t===-1)throw new Error("Purchase order not found");return n.splice(t,1),!0}async function v(r){await i(300);const t=n.find(s=>s.id===parseInt(r));if(!t)throw new Error("Purchase order not found");return t.status="submitted",t.submittedAt=new Date().toISOString(),a.fromAPI(t).needsApproval()?t.approvalStatus="pending":(t.approvalStatus="approved",t.status="approved"),t.updatedAt=new Date().toISOString(),a.fromAPI(t)}async function y(r,t,e){await i(300);const s=n.find(u=>u.id===parseInt(r));if(!s)throw new Error("Purchase order not found");const o=a.fromAPI(s);if(!o.canApprove(t))throw new Error("User cannot approve this purchase order");return o.approve(t,e),Object.assign(s,o.toJSON()),s.approvalStatus==="approved"&&(s.status="approved"),s.updatedAt=new Date().toISOString(),a.fromAPI(s)}async function I(r,t,e){await i(300);const s=n.find(u=>u.id===parseInt(r));if(!s)throw new Error("Purchase order not found");const o=a.fromAPI(s);return o.reject(t,e),Object.assign(s,o.toJSON()),s.status="cancelled",s.updatedAt=new Date().toISOString(),a.fromAPI(s)}async function g(r,t){await i(300);const e=n.find(s=>s.id===parseInt(r));if(!e)throw new Error("Purchase order not found");return e.status=t,e.updatedAt=new Date().toISOString(),a.fromAPI(e)}async function S(r,t,e){await i(200);const s=n.find(o=>o.id===parseInt(r));if(!s)throw new Error("Purchase order not found");return s.trackingNumber=t,s.carrier=e,s.status="shipped",s.updatedAt=new Date().toISOString(),a.fromAPI(s)}async function P(r){await i(200);const t=n.find(e=>e.id===parseInt(r));if(!t)throw new Error("Purchase order not found");return t.status="delivered",t.actualDeliveryDate=new Date().toISOString().split("T")[0],t.updatedAt=new Date().toISOString(),a.fromAPI(t)}async function w(r,t,e=0){await i(200);const s=n.find(o=>o.id===parseInt(r));if(!s)throw new Error("Purchase order not found");return s.paymentStatus=t,s.paidAmount=e,s.updatedAt=new Date().toISOString(),a.fromAPI(s)}async function O(r,t){await i(300);const e=n.find(s=>s.id===parseInt(r));if(!e)throw new Error("Purchase order not found");return e.status="cancelled",e.internalNotes=`${e.internalNotes}
Cancelled: ${t}`,e.updatedAt=new Date().toISOString(),a.fromAPI(e)}async function D(){return await i(200),{total:n.length,draft:n.filter(r=>r.status==="draft").length,submitted:n.filter(r=>r.status==="submitted").length,approved:n.filter(r=>r.status==="approved").length,pendingApproval:n.filter(r=>r.approvalStatus==="pending").length,processing:n.filter(r=>r.status==="processing").length,shipped:n.filter(r=>r.status==="shipped").length,delivered:n.filter(r=>r.status==="delivered").length,cancelled:n.filter(r=>r.status==="cancelled").length,totalValue:n.reduce((r,t)=>r+t.total,0),averageValue:n.length>0?n.reduce((r,t)=>r+t.total,0)/n.length:0,unpaid:n.filter(r=>r.paymentStatus==="unpaid").length,paid:n.filter(r=>r.paymentStatus==="paid").length}}async function b(r){return await i(200),n.filter(e=>e.approvalStatus==="pending"&&e.approvers.some(s=>s.userId===r&&s.status==="pending")).map(e=>a.fromAPI(e))}const C={getPurchaseOrders:c,getPurchaseOrderById:d,getPurchaseOrderByNumber:l,getPurchaseOrdersForCompany:h,createPurchaseOrder:m,updatePurchaseOrder:f,deletePurchaseOrder:A,submitPurchaseOrder:v,approvePurchaseOrder:y,rejectPurchaseOrder:I,updatePOStatus:g,addTrackingInfo:S,markAsDelivered:P,updatePaymentStatus:w,cancelPurchaseOrder:O,getPOStats:D,getPendingApprovalsForUser:b};export{S as addTrackingInfo,y as approvePurchaseOrder,O as cancelPurchaseOrder,m as createPurchaseOrder,C as default,A as deletePurchaseOrder,D as getPOStats,b as getPendingApprovalsForUser,d as getPurchaseOrderById,l as getPurchaseOrderByNumber,c as getPurchaseOrders,h as getPurchaseOrdersForCompany,P as markAsDelivered,I as rejectPurchaseOrder,v as submitPurchaseOrder,g as updatePOStatus,w as updatePaymentStatus,f as updatePurchaseOrder};
