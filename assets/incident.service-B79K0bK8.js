import{Q as g,P as l}from"./index-DfU7H5-o.js";let c=null;async function o(){return c||(c=await g("/incidents.json")),[...c]}async function m(r){return(await o()).find(n=>n.id===parseInt(r))}async function h(r){return(await o()).find(n=>n.incidentNumber===r)}async function y(r){await l(500);const e=await o(),n={id:Math.max(...e.map(t=>t.id))+1,incidentNumber:`INC-${new Date().getFullYear()}-${String(e.length+1).padStart(3,"0")}`,...r,reportedDate:new Date().toISOString(),resolvedDate:null,resolutionTime:null,slaMet:!0,status:r.status||"open"};return e.push(n),c=e,localStorage.setItem("incidents_cache",JSON.stringify(e)),n}async function I(r,e){await l(500);const n=await o(),t=n.findIndex(s=>s.id===parseInt(r));if(t===-1)throw new Error("Incident not found");if(e.status==="resolved"&&!n[t].resolvedDate){e.resolvedDate=new Date().toISOString();const s=new Date(n[t].reportedDate),i=new Date(e.resolvedDate);e.resolutionTime=(i-s)/(1e3*60*60),e.slaMet=e.resolutionTime<=n[t].slaTarget}return n[t]={...n[t],...e},c=n,localStorage.setItem("incidents_cache",JSON.stringify(n)),n[t]}async function p(r){await l(500);const e=await o(),n=e.findIndex(t=>t.id===parseInt(r));if(n===-1)throw new Error("Incident not found");return e.splice(n,1),c=e,localStorage.setItem("incidents_cache",JSON.stringify(e)),!0}async function w(r){return(await o()).filter(n=>n.category===r)}async function S(r){return(await o()).filter(n=>n.status===r)}async function v(){const r=await o(),e={problem_resolution:{name:"Problem Resolution",incidents:[]},claim_resolution:{name:"Claim Resolution",incidents:[]},order_confirmation:{name:"Order Confirmation",incidents:[]},inventory_accuracy:{name:"Inventory Accuracy",incidents:[]},sourcing:{name:"Sourcing",incidents:[]},urgent_orders:{name:"Urgent Orders",incidents:[]}};r.forEach(t=>{e[t.category]&&e[t.category].incidents.push(t)});const n={};return Object.keys(e).forEach(t=>{const s=e[t].incidents,i=s.filter(a=>a.status==="resolved"),d=i.filter(a=>a.slaMet).length;n[t]={name:e[t].name,total:s.length,resolved:i.length,slaMet:d,slaPercentage:i.length>0?Math.round(d/i.length*100):0,open:s.filter(a=>a.status==="open").length,inProgress:s.filter(a=>a.status==="in_progress").length,avgResolutionTime:i.length>0?(i.reduce((a,u)=>a+(u.resolutionTime||0),0)/i.length).toFixed(2):0,targetSLA:s.length>0?s[0].slaTarget:0}}),n}async function D(){const r=await o(),e=r.filter(t=>t.status==="resolved"),n=e.filter(t=>t.slaMet).length;return{totalIncidents:r.length,openIncidents:r.filter(t=>t.status==="open").length,inProgressIncidents:r.filter(t=>t.status==="in_progress").length,resolvedIncidents:e.length,slaMetCount:n,slaMetPercentage:e.length>0?Math.round(n/e.length*100):0,criticalIncidents:r.filter(t=>t.severity==="critical"&&t.status!=="resolved").length,urgentIncidents:r.filter(t=>t.priority==="urgent"&&t.status!=="resolved").length,avgResolutionTime:e.length>0?(e.reduce((t,s)=>t+(s.resolutionTime||0),0)/e.length).toFixed(2):0}}async function T(){try{const r=await o();return localStorage.setItem("incidents_cache",JSON.stringify(r)),r}catch(r){return console.error("Failed to initialize incidents cache:",r),[]}}function C(r){const e=["Incident Number","Title","Category","Priority","Status","Severity","Reported By","Assigned To","Reported Date","Due Date","Resolved Date","Resolution Time (hrs)","SLA Target (hrs)","SLA Met","Impacted Customers"],n=r.map(s=>[s.incidentNumber,s.title,s.category,s.priority,s.status,s.severity,s.reportedBy,s.assignedTo,new Date(s.reportedDate).toLocaleString(),new Date(s.dueDate).toLocaleString(),s.resolvedDate?new Date(s.resolvedDate).toLocaleString():"N/A",s.resolutionTime||"N/A",s.slaTarget,s.slaMet?"Yes":"No",s.impactedCustomers]);return[e.join(","),...n.map(s=>s.map(i=>`"${i}"`).join(","))].join(`
`)}export{y as createIncident,p as deleteIncident,C as exportIncidentsToCSV,m as getIncidentById,h as getIncidentByNumber,o as getIncidents,w as getIncidentsByCategory,S as getIncidentsByStatus,D as getSLADashboardStats,v as getSLAMetrics,T as initializeIncidentsCache,I as updateIncident};
