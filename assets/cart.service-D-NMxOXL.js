import{P as c}from"./index-ClUva-wm.js";import{getProductById as d}from"./product.service-D2mQ2hSR.js";import"./product.model-uhuUaOub.js";class r{constructor(t={}){this.id=t.id||null,this.sessionId=t.sessionId||"",this.customerId=t.customerId||null,this.items=t.items||[],this.subtotal=t.subtotal||0,this.tax=t.tax||0,this.taxRate=t.taxRate||0,this.shipping=t.shipping||0,this.discount=t.discount||0,this.discountCode=t.discountCode||"",this.total=t.total||0,this.currency=t.currency||"USD",this.createdAt=t.createdAt||new Date().toISOString(),this.updatedAt=t.updatedAt||new Date().toISOString(),this.expiresAt=t.expiresAt||null}addItem(t,i=1){const s=this.items.find(a=>a.productId===t.id);s?s.quantity+=i:this.items.push({productId:t.id,name:t.name,sku:t.sku,price:t.price,quantity:i,image:t.featuredImage||t.images&&t.images[0]||""}),this.calculateTotals(),this.updatedAt=new Date().toISOString()}removeItem(t){this.items=this.items.filter(i=>i.productId!==t),this.calculateTotals(),this.updatedAt=new Date().toISOString()}updateQuantity(t,i){const s=this.items.find(a=>a.productId===t);s&&(i<=0?this.removeItem(t):(s.quantity=i,this.calculateTotals(),this.updatedAt=new Date().toISOString()))}clear(){this.items=[],this.subtotal=0,this.tax=0,this.shipping=0,this.discount=0,this.discountCode="",this.total=0,this.updatedAt=new Date().toISOString()}calculateTotals(){return this.subtotal=this.items.reduce((t,i)=>t+i.price*i.quantity,0),this.tax=this.subtotal*this.taxRate/100,this.total=this.subtotal+this.tax+this.shipping-this.discount,{subtotal:this.subtotal,tax:this.tax,shipping:this.shipping,discount:this.discount,total:this.total}}getItemCount(){return this.items.reduce((t,i)=>t+i.quantity,0)}isEmpty(){return this.items.length===0}applyDiscount(t,i){this.discountCode=t,this.discount=i,this.calculateTotals()}removeDiscount(){this.discountCode="",this.discount=0,this.calculateTotals()}isExpired(){return this.expiresAt?new Date(this.expiresAt)<new Date:!1}toJSON(){return{id:this.id,sessionId:this.sessionId,customerId:this.customerId,items:this.items,subtotal:this.subtotal,tax:this.tax,taxRate:this.taxRate,shipping:this.shipping,discount:this.discount,discountCode:this.discountCode,total:this.total,currency:this.currency,createdAt:this.createdAt,updatedAt:this.updatedAt,expiresAt:this.expiresAt}}static fromAPI(t){return new r(t)}}let n={};async function u(e,t=null){await c(200);const i=t||e;return n[i]||(n[i]={id:i,sessionId:e,customerId:t,items:[],subtotal:0,tax:0,taxRate:10,shipping:0,discount:0,discountCode:"",total:0,currency:"USD",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),expiresAt:new Date(Date.now()+7*24*60*60*1e3).toISOString()}),r.fromAPI(n[i])}async function p(e,t,i=1,s=null){await c(300);const a=await d(t);if(!a)throw new Error("Product not found");if(!a.isInStock())throw new Error("Product is out of stock");const o=await u(e,s);o.addItem(a,i);const l=s||e;return n[l]=o.toJSON(),r.fromAPI(n[l])}async function m(e,t,i=null){await c(200);const s=await u(e,i);s.removeItem(t);const a=i||e;return n[a]=s.toJSON(),r.fromAPI(n[a])}async function f(e,t,i,s=null){await c(200);const a=await u(e,s);a.updateQuantity(t,i);const o=s||e;return n[o]=a.toJSON(),r.fromAPI(n[o])}async function y(e,t=null){await c(200);const i=await u(e,t);i.clear();const s=t||e;return n[s]=i.toJSON(),r.fromAPI(n[s])}async function w(e,t,i=null){await c(300);const a={SAVE10:{type:"percentage",value:10},SAVE20:{type:"percentage",value:20},FLAT50:{type:"fixed",value:50}}[t.toUpperCase()];if(!a)throw new Error("Invalid discount code");const o=await u(e,i);let l=0;a.type==="percentage"?l=o.subtotal*a.value/100:a.type==="fixed"&&(l=a.value),o.applyDiscount(t,l);const h=i||e;return n[h]=o.toJSON(),r.fromAPI(n[h])}async function A(e,t=null){await c(200);const i=await u(e,t);i.removeDiscount();const s=t||e;return n[s]=i.toJSON(),r.fromAPI(n[s])}async function g(e,t,i=null){await c(200);const s=await u(e,i);s.shipping=t,s.calculateTotals();const a=i||e;return n[a]=s.toJSON(),r.fromAPI(n[a])}async function S(e,t){await c(300);const i=n[e],s=n[t];if(!i)return s?r.fromAPI(s):await u(e,t);if(!s)return n[t]={...i,customerId:t},delete n[e],r.fromAPI(n[t]);const a=r.fromAPI(s);return i.items.forEach(o=>{a.addItem({id:o.productId,...o},o.quantity)}),n[t]=a.toJSON(),delete n[e],a}async function x(e,t=null){return await c(100),(await u(e,t)).getItemCount()}const O={getCart:u,addToCart:p,removeFromCart:m,updateCartItemQuantity:f,clearCart:y,applyDiscountCode:w,removeDiscountCode:A,updateShipping:g,mergeCarts:S,getCartItemCount:x};export{p as addToCart,w as applyDiscountCode,y as clearCart,O as default,u as getCart,x as getCartItemCount,S as mergeCarts,A as removeDiscountCode,m as removeFromCart,f as updateCartItemQuantity,g as updateShipping};
